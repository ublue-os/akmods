---
# This is a generated workflow. Do not edit by hand.
# Generate the workflow by running ./generate-workflows.sh at git root
# Modify the inputs in ./workflow-templates
name: Build AKMODs
on:
  merge_group:
  pull_request:
    branches:
      - main
    paths-ignore:
      - '**.md'
  schedule:
    - cron: '25 0 * * *'  # 0025 UTC everyday (20 minutes after 42)
  workflow_dispatch:
    inputs:
      bazzite_tag:
        description: "The release tag for the bazzite kernel"
        required: false
        type: string

jobs:
  cache_kernel_centos-hsk_10:
    name: Cache centos-hsk (10)
    uses: ./.github/workflows/reusable-cache-kernel.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    with:
      bazzite_tag: ${{ inputs.bazzite_tag }}
      kernel_flavor: centos-hsk
      version: 10
  build-centos-hsk_10_nvidia:
    name: Build nvidia centos-hsk (10)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_centos-hsk_10
    with:
      version: 10
      kernel_flavor: centos-hsk
      akmods_target: nvidia
      kernel_cache_key: ${{ needs.cache_kernel_centos-hsk_10.outputs.KCKEY }}
  build-centos-hsk_10_nvidia-open:
    name: Build nvidia-open centos-hsk (10)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_centos-hsk_10
    with:
      version: 10
      kernel_flavor: centos-hsk
      akmods_target: nvidia-open
      kernel_cache_key: ${{ needs.cache_kernel_centos-hsk_10.outputs.KCKEY }}
  build-centos-hsk_10_zfs:
    name: Build zfs centos-hsk (10)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_centos-hsk_10
    with:
      version: 10
      kernel_flavor: centos-hsk
      akmods_target: zfs
      kernel_cache_key: ${{ needs.cache_kernel_centos-hsk_10.outputs.KCKEY }}
  cache_kernel_bazzite_42:
    name: Cache bazzite (42)
    uses: ./.github/workflows/reusable-cache-kernel.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    with:
      bazzite_tag: ${{ inputs.bazzite_tag }}
      kernel_flavor: bazzite
      version: 42
  build-bazzite_42_common:
    name: Build common bazzite (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_bazzite_42
    with:
      version: 42
      kernel_flavor: bazzite
      akmods_target: common
      kernel_cache_key: ${{ needs.cache_kernel_bazzite_42.outputs.KCKEY }}
  build-bazzite_42_extra:
    name: Build extra bazzite (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_bazzite_42
    with:
      version: 42
      kernel_flavor: bazzite
      akmods_target: extra
      kernel_cache_key: ${{ needs.cache_kernel_bazzite_42.outputs.KCKEY }}
  build-bazzite_42_nvidia:
    name: Build nvidia bazzite (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_bazzite_42
    with:
      version: 42
      kernel_flavor: bazzite
      akmods_target: nvidia
      kernel_cache_key: ${{ needs.cache_kernel_bazzite_42.outputs.KCKEY }}
  build-bazzite_42_nvidia-open:
    name: Build nvidia-open bazzite (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_bazzite_42
    with:
      version: 42
      kernel_flavor: bazzite
      akmods_target: nvidia-open
      kernel_cache_key: ${{ needs.cache_kernel_bazzite_42.outputs.KCKEY }}
  cache_kernel_longterm-6-12_42:
    name: Cache longterm-6.12 (42)
    uses: ./.github/workflows/reusable-cache-kernel.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    with:
      bazzite_tag: ${{ inputs.bazzite_tag }}
      kernel_flavor: longterm-6.12
      version: 42
  build-longterm-6-12_42_common:
    name: Build common longterm-6.12 (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_longterm-6-12_42
    with:
      version: 42
      kernel_flavor: longterm-6.12
      akmods_target: common
      kernel_cache_key: ${{ needs.cache_kernel_longterm-6-12_42.outputs.KCKEY }}
  build-longterm-6-12_42_nvidia:
    name: Build nvidia longterm-6.12 (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_longterm-6-12_42
    with:
      version: 42
      kernel_flavor: longterm-6.12
      akmods_target: nvidia
      kernel_cache_key: ${{ needs.cache_kernel_longterm-6-12_42.outputs.KCKEY }}
  build-longterm-6-12_42_nvidia-open:
    name: Build nvidia-open longterm-6.12 (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_longterm-6-12_42
    with:
      version: 42
      kernel_flavor: longterm-6.12
      akmods_target: nvidia-open
      kernel_cache_key: ${{ needs.cache_kernel_longterm-6-12_42.outputs.KCKEY }}
  build-longterm-6-12_42_zfs:
    name: Build zfs longterm-6.12 (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_longterm-6-12_42
    with:
      version: 42
      kernel_flavor: longterm-6.12
      akmods_target: zfs
      kernel_cache_key: ${{ needs.cache_kernel_longterm-6-12_42.outputs.KCKEY }}
  cache_kernel_main_41:
    name: Cache main (41)
    uses: ./.github/workflows/reusable-cache-kernel.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    with:
      bazzite_tag: ${{ inputs.bazzite_tag }}
      kernel_flavor: main
      version: 41
  build-main_41_common:
    name: Build common main (41)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_main_41
    with:
      version: 41
      kernel_flavor: main
      akmods_target: common
      kernel_cache_key: ${{ needs.cache_kernel_main_41.outputs.KCKEY }}
  build-main_41_nvidia:
    name: Build nvidia main (41)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_main_41
    with:
      version: 41
      kernel_flavor: main
      akmods_target: nvidia
      kernel_cache_key: ${{ needs.cache_kernel_main_41.outputs.KCKEY }}
  build-main_41_nvidia-open:
    name: Build nvidia-open main (41)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_main_41
    with:
      version: 41
      kernel_flavor: main
      akmods_target: nvidia-open
      kernel_cache_key: ${{ needs.cache_kernel_main_41.outputs.KCKEY }}
  cache_kernel_centos_10:
    name: Cache centos (10)
    uses: ./.github/workflows/reusable-cache-kernel.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    with:
      bazzite_tag: ${{ inputs.bazzite_tag }}
      kernel_flavor: centos
      version: 10
  build-centos_10_nvidia:
    name: Build nvidia centos (10)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_centos_10
    with:
      version: 10
      kernel_flavor: centos
      akmods_target: nvidia
      kernel_cache_key: ${{ needs.cache_kernel_centos_10.outputs.KCKEY }}
  build-centos_10_nvidia-open:
    name: Build nvidia-open centos (10)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_centos_10
    with:
      version: 10
      kernel_flavor: centos
      akmods_target: nvidia-open
      kernel_cache_key: ${{ needs.cache_kernel_centos_10.outputs.KCKEY }}
  build-centos_10_zfs:
    name: Build zfs centos (10)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_centos_10
    with:
      version: 10
      kernel_flavor: centos
      akmods_target: zfs
      kernel_cache_key: ${{ needs.cache_kernel_centos_10.outputs.KCKEY }}
  cache_kernel_coreos-testing_41:
    name: Cache coreos-testing (41)
    uses: ./.github/workflows/reusable-cache-kernel.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    with:
      bazzite_tag: ${{ inputs.bazzite_tag }}
      kernel_flavor: coreos-testing
      version: 41
  build-coreos-testing_41_common:
    name: Build common coreos-testing (41)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_coreos-testing_41
    with:
      version: 41
      kernel_flavor: coreos-testing
      akmods_target: common
      kernel_cache_key: ${{ needs.cache_kernel_coreos-testing_41.outputs.KCKEY }}
  build-coreos-testing_41_nvidia:
    name: Build nvidia coreos-testing (41)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_coreos-testing_41
    with:
      version: 41
      kernel_flavor: coreos-testing
      akmods_target: nvidia
      kernel_cache_key: ${{ needs.cache_kernel_coreos-testing_41.outputs.KCKEY }}
  build-coreos-testing_41_nvidia-open:
    name: Build nvidia-open coreos-testing (41)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_coreos-testing_41
    with:
      version: 41
      kernel_flavor: coreos-testing
      akmods_target: nvidia-open
      kernel_cache_key: ${{ needs.cache_kernel_coreos-testing_41.outputs.KCKEY }}
  build-coreos-testing_41_zfs:
    name: Build zfs coreos-testing (41)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_coreos-testing_41
    with:
      version: 41
      kernel_flavor: coreos-testing
      akmods_target: zfs
      kernel_cache_key: ${{ needs.cache_kernel_coreos-testing_41.outputs.KCKEY }}
  cache_kernel_main_42:
    name: Cache main (42)
    uses: ./.github/workflows/reusable-cache-kernel.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    with:
      bazzite_tag: ${{ inputs.bazzite_tag }}
      kernel_flavor: main
      version: 42
  build-main_42_common:
    name: Build common main (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_main_42
    with:
      version: 42
      kernel_flavor: main
      akmods_target: common
      kernel_cache_key: ${{ needs.cache_kernel_main_42.outputs.KCKEY }}
  build-main_42_nvidia:
    name: Build nvidia main (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_main_42
    with:
      version: 42
      kernel_flavor: main
      akmods_target: nvidia
      kernel_cache_key: ${{ needs.cache_kernel_main_42.outputs.KCKEY }}
  build-main_42_nvidia-open:
    name: Build nvidia-open main (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_main_42
    with:
      version: 42
      kernel_flavor: main
      akmods_target: nvidia-open
      kernel_cache_key: ${{ needs.cache_kernel_main_42.outputs.KCKEY }}
  cache_kernel_coreos-stable_42:
    name: Cache coreos-stable (42)
    uses: ./.github/workflows/reusable-cache-kernel.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    with:
      bazzite_tag: ${{ inputs.bazzite_tag }}
      kernel_flavor: coreos-stable
      version: 42
  build-coreos-stable_42_common:
    name: Build common coreos-stable (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_coreos-stable_42
    with:
      version: 42
      kernel_flavor: coreos-stable
      akmods_target: common
      kernel_cache_key: ${{ needs.cache_kernel_coreos-stable_42.outputs.KCKEY }}
  build-coreos-stable_42_nvidia:
    name: Build nvidia coreos-stable (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_coreos-stable_42
    with:
      version: 42
      kernel_flavor: coreos-stable
      akmods_target: nvidia
      kernel_cache_key: ${{ needs.cache_kernel_coreos-stable_42.outputs.KCKEY }}
  build-coreos-stable_42_nvidia-open:
    name: Build nvidia-open coreos-stable (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_coreos-stable_42
    with:
      version: 42
      kernel_flavor: coreos-stable
      akmods_target: nvidia-open
      kernel_cache_key: ${{ needs.cache_kernel_coreos-stable_42.outputs.KCKEY }}
  build-coreos-stable_42_zfs:
    name: Build zfs coreos-stable (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_coreos-stable_42
    with:
      version: 42
      kernel_flavor: coreos-stable
      akmods_target: zfs
      kernel_cache_key: ${{ needs.cache_kernel_coreos-stable_42.outputs.KCKEY }}
  cache_kernel_coreos-testing_42:
    name: Cache coreos-testing (42)
    uses: ./.github/workflows/reusable-cache-kernel.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    with:
      bazzite_tag: ${{ inputs.bazzite_tag }}
      kernel_flavor: coreos-testing
      version: 42
  build-coreos-testing_42_common:
    name: Build common coreos-testing (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_coreos-testing_42
    with:
      version: 42
      kernel_flavor: coreos-testing
      akmods_target: common
      kernel_cache_key: ${{ needs.cache_kernel_coreos-testing_42.outputs.KCKEY }}
  build-coreos-testing_42_nvidia:
    name: Build nvidia coreos-testing (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_coreos-testing_42
    with:
      version: 42
      kernel_flavor: coreos-testing
      akmods_target: nvidia
      kernel_cache_key: ${{ needs.cache_kernel_coreos-testing_42.outputs.KCKEY }}
  build-coreos-testing_42_nvidia-open:
    name: Build nvidia-open coreos-testing (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_coreos-testing_42
    with:
      version: 42
      kernel_flavor: coreos-testing
      akmods_target: nvidia-open
      kernel_cache_key: ${{ needs.cache_kernel_coreos-testing_42.outputs.KCKEY }}
  build-coreos-testing_42_zfs:
    name: Build zfs coreos-testing (42)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_coreos-testing_42
    with:
      version: 42
      kernel_flavor: coreos-testing
      akmods_target: zfs
      kernel_cache_key: ${{ needs.cache_kernel_coreos-testing_42.outputs.KCKEY }}
  cache_kernel_coreos-stable_41:
    name: Cache coreos-stable (41)
    uses: ./.github/workflows/reusable-cache-kernel.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    with:
      bazzite_tag: ${{ inputs.bazzite_tag }}
      kernel_flavor: coreos-stable
      version: 41
  build-coreos-stable_41_common:
    name: Build common coreos-stable (41)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_coreos-stable_41
    with:
      version: 41
      kernel_flavor: coreos-stable
      akmods_target: common
      kernel_cache_key: ${{ needs.cache_kernel_coreos-stable_41.outputs.KCKEY }}
  build-coreos-stable_41_nvidia:
    name: Build nvidia coreos-stable (41)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_coreos-stable_41
    with:
      version: 41
      kernel_flavor: coreos-stable
      akmods_target: nvidia
      kernel_cache_key: ${{ needs.cache_kernel_coreos-stable_41.outputs.KCKEY }}
  build-coreos-stable_41_nvidia-open:
    name: Build nvidia-open coreos-stable (41)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_coreos-stable_41
    with:
      version: 41
      kernel_flavor: coreos-stable
      akmods_target: nvidia-open
      kernel_cache_key: ${{ needs.cache_kernel_coreos-stable_41.outputs.KCKEY }}
  build-coreos-stable_41_zfs:
    name: Build zfs coreos-stable (41)
    uses: ./.github/workflows/reusable-build.yml
    secrets: inherit
    permissions:
      actions: read
      contents: read
      packages: write
    needs: cache_kernel_coreos-stable_41
    with:
      version: 41
      kernel_flavor: coreos-stable
      akmods_target: zfs
      kernel_cache_key: ${{ needs.cache_kernel_coreos-stable_41.outputs.KCKEY }}
