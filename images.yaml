---
defaults:
  kernel_flavor: main
  version: 43
  akmods_target: common

arch-arm-x86: &arch-arm-x86
  architecture:
    - aarch64
    - x86_64

arch-only-x86: &arch-only-x86
  architecture:
    - x86_64

akmods-base: &akmods-base
  org: ublue-os
  registry: ghcr.io
  repo: akmods
  transport: docker://

akmods-common: &akmods-common
  name: akmods
  description: "A caching layer for pre-built akmod RPMs"

akmods-nvidia-lts: &akmods-nvidia-lts
  name: akmods-nvidia-lts
  description: "A caching layer for the pre-built nvidia-lts akmod RPMs"

akmods-nvidia-open: &akmods-nvidia-open
  name: akmods-nvidia-open
  description: "A caching layer for the pre-built nvidia-open akmod RPMs"

akmods-zfs: &akmods-zfs
  name: akmods-zfs
  description: "A caching layer for the pre-built zfs akmod RPMs"

desktop-build-group-only-x86: &desktop-build-group-only-x86
  common:
    !!merge <<:
      - *akmods-base
      - *akmods-common
      - *arch-only-x86
  nvidia-lts:
    !!merge <<:
      - *akmods-base
      - *akmods-nvidia-lts
      - *arch-only-x86
  nvidia-open:
    !!merge <<:
      - *akmods-base
      - *akmods-nvidia-open
      - *arch-only-x86

desktop-build-group: &desktop-build-group
  common:
    !!merge <<:
      - *akmods-base
      - *akmods-common
      - *arch-arm-x86
  nvidia-lts:
    !!merge <<:
      - *akmods-base
      - *akmods-nvidia-lts
      - *arch-arm-x86
  nvidia-open:
    !!merge <<:
      - *akmods-base
      - *akmods-nvidia-open
      - *arch-arm-x86

server-build-group-only-x86: &server-build-group-only-x86
  nvidia-lts:
    !!merge <<:
      - *akmods-base
      - *akmods-nvidia-lts
      - *arch-only-x86
  nvidia-open:
    !!merge <<:
      - *akmods-base
      - *akmods-nvidia-open
      - *arch-only-x86
  zfs:
    !!merge <<:
      - *akmods-base
      - *akmods-zfs
      - *arch-only-x86

server-build-group: &server-build-group
  nvidia-lts:
    !!merge <<:
      - *akmods-base
      - *akmods-nvidia-lts
      - *arch-arm-x86
  nvidia-open:
    !!merge <<:
      - *akmods-base
      - *akmods-nvidia-open
      - *arch-arm-x86
  zfs:
    !!merge <<:
      - *akmods-base
      - *akmods-zfs
      - *arch-arm-x86

images:
  10:
    centos:
      !!merge <<:
        - *server-build-group
  42:
    main:
      !!merge <<:
        - *desktop-build-group-only-x86
    coreos-stable:
      !!merge <<:
        - *desktop-build-group
        - *server-build-group
  43:
    main:
      !!merge <<:
        - *desktop-build-group-only-x86
    coreos-stable:
      !!merge <<:
        - *desktop-build-group
        - *server-build-group
    coreos-testing:
      !!merge <<:
        - *desktop-build-group
        - *server-build-group
    "longterm-6.12":
      !!merge <<:
        - *server-build-group
